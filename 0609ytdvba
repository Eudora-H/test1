Sub TestDateFilling()
    Dim wb As Workbook
    Dim ws As Worksheet
    Dim filePath As Variant
    Dim lastRow As Long
    Dim i As Long
    Dim currentDate As String
    
    ' File selection
    filePath = Application.GetOpenFilename( _
        FileFilter:="Excel Files (*.xls; *.xlsx; *.xlsm), *.xls; *.xlsx; *.xlsm", _
        Title:="Please select file", _
        MultiSelect:=False)
    
    If filePath = False Then Exit Sub
    
    ' Open workbook
    Set wb = Workbooks.Open(filePath)
    Set ws = wb.Worksheets(1)
    
    ' Get the current date
    currentDate = Format(Date, "yyyy-mm-dd")
    
    ' Method 1: Find last row with data in any column
    lastRow = ws.Cells.Find("*", SearchOrder:=xlByRows, SearchDirection:=xlPrevious).Row
    MsgBox "Last row with data: " & lastRow
    
    ' Insert column
    ws.Columns("A:A").Insert
    ws.Range("A1").Value = "as_of_date"
    
    ' Try different methods to fill dates
    MsgBox "Trying Method 1: Direct value assignment"
    For i = 2 To lastRow
        ws.Cells(i, 1).Value = currentDate
    Next i
    
    ' Check results
    MsgBox "Method 1 Results:" & vbCrLf & _
           "A2: " & ws.Range("A2").Value & vbCrLf & _
           "A3: " & ws.Range("A3").Value
    
    ' If still blank, try Method 2
    If ws.Range("A2").Value = "" Then
        MsgBox "Method 1 failed. Trying Method 2: Using DateValue"
        For i = 2 To lastRow
            ws.Cells(i, 1).Value = DateValue(Now)
            ws.Cells(i, 1).NumberFormat = "yyyy-mm-dd"
        Next i
        
        MsgBox "Method 2 Results:" & vbCrLf & _
               "A2: " & ws.Range("A2").Value & vbCrLf & _
               "A3: " & ws.Range("A3").Value
    End If
    
    ' If still blank, try Method 3
    If ws.Range("A2").Value = "" Then
        MsgBox "Method 2 failed. Trying Method 3: Formula approach"
        ws.Range("A2").Formula = "=""" & currentDate & """"
        ws.Range("A2").Copy
        ws.Range("A3:A" & lastRow).PasteSpecial xlPasteFormulas
        ' Convert formulas to values
        ws.Range("A2:A" & lastRow).Copy
        ws.Range("A2:A" & lastRow).PasteSpecial xlPasteValues
        Application.CutCopyMode = False
        
        MsgBox "Method 3 Results:" & vbCrLf & _
               "A2: " & ws.Range("A2").Value & vbCrLf & _
               "A3: " & ws.Range("A3").Value
    End If
    
    ' Final check - count non-empty cells
    Dim filledCount As Long
    filledCount = Application.CountA(ws.Range("A2:A" & lastRow))
    
    MsgBox "Final Summary:" & vbCrLf & _
           "Total rows to fill: " & (lastRow - 1) & vbCrLf & _
           "Actually filled: " & filledCount & vbCrLf & _
           "Current date used: " & currentDate
    
End Sub
